import subprocess
from flask import jsonify


def run_ettercap(target):
    try:
        interface = "eth0"  # ou détecté dynamiquement
        cmd = ["ettercap", "-T", "-i", interface, "-M", "arp:remote", f"/{target}//"]
        result = subprocess.run(cmd, capture_output=True, text=True, timeout=30)

        return jsonify({
            "result": f"Ettercap lancé sur l'interface {interface}:\n{result.stdout}",
            "error": result.stderr
        })
    except subprocess.TimeoutExpired:
        return jsonify({"result": "Scan Ettercap terminé (timeout après 30 secondes)"})
    except Exception as e:
        return jsonify({"error": f"Erreur Ettercap: {str(e)}"})

